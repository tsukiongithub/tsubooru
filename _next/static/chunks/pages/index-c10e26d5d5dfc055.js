(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(9359)}])},9359:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var n=s(5893),l=s(1163),a=s(7294),r=s(4284),i={src:"/_next/static/media/tail-spin.c6358cae.svg",height:38,width:38},c=s(9008),o=s.n(c),u=s(5675),d=s.n(u),h=s(1664),f=s.n(h);let m=e=>{let t=Number(e);return isNaN(t)?0:t};var p=function(e){let t=Math.floor(Math.log10(e)/3),s=["","K","M","B","T"][t];return Math.floor(e/Math.pow(10,3*t)).toString()+s};let g=()=>{let e=(0,l.useRouter)(),{tags:t}=e.query,[s,i]=(0,a.useState)([]),[c,o]=(0,a.useState)(!1),[u,d]=(0,a.useState)(-1),[h,f]=(0,a.useState)(""),[m,g]=(0,a.useState)(""),{data:x,isSuccess:v,refetch:w}=r.S.gelbooru.getTags.useQuery({search:m});(0,a.useEffect)(()=>{document.addEventListener("keydown",e=>{let t=document.querySelector("#searchInput");"/"===e.key&&document.activeElement!==t&&(e.preventDefault(),t.focus())})},[]),(0,a.useEffect)(()=>{v&&x&&x.tags&&i(x.tags.map(e=>({count:e.count,name:e.name,type:e.type}))),m.length>=1?o(!0):o(!1)},[v,x,m,m.length]),(0,a.useEffect)(()=>{void 0!==t&&t.length>0&&f("".concat(t.replaceAll("+"," ")," "))},[t]);let b=t=>{t.preventDefault(),-1===u?(h.lastIndexOf(" ")===h.length-1?f("".concat(h)):f("".concat(h," ")),g(""),e.query.tags=h.trim().replaceAll(" ","+"),e.push(e)):void 0!==s[u]?(d(-1),f("".concat(h.substring(0,h.lastIndexOf(" ")+1).toLowerCase()).concat(s[u].name," ")),g("")):""!==m.trim()&&(d(-1),f("".concat(h," ")),g(""))},j=e=>{let t=e.currentTarget.value,n=t.substring(t.lastIndexOf(" ")+1).toLowerCase();if(f(t),g(n),m.length>1){w();let l=s.filter(e=>e.name.toLowerCase().indexOf(m)>-1);void 0!==l&&i(l)}},y=e=>{let t=e.currentTarget.children[1];d(-1),f("".concat(t.innerText.replace(" ","_")," ")),g("")},N=e=>{if("Escape"===e.key)e.preventDefault(),c?(d(-1),o(!1)):e.currentTarget.blur();else if("ArrowUp"===e.key&&""!==h){if(e.preventDefault(),!1===c&&o(!0),0===u)return;d(u-1)}else if("ArrowDown"===e.key&&""!==h){if(e.preventDefault(),!1===c&&o(!0),u===s.length-1)return;d(u+1)}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("form",{onSubmit:b,autoComplete:"false",children:(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-4 sm:flex-row",children:[(0,n.jsxs)("div",{className:"relative w-full",children:[(0,n.jsx)("input",{className:"w-full rounded-md border-2 border-gray-200 bg-gray-100 px-1 py-2 text-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-black sm:h-full",type:"text",id:"searchInput",value:h,onChange:j,onKeyDown:N}),c?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("ul",{className:"absolute inset-x-0 top-full z-10 mt-1 rounded-b-md",children:s.map((e,t)=>(0,n.jsxs)("li",{className:"".concat(t===u?"bg-red-400":"bg-gray-300"," flex cursor-pointer py-2 px-4 first:rounded-t-md last:rounded-b-md hover:bg-red-500"),onClick:y,children:[(0,n.jsx)("div",{className:"mr-3 w-[4ch]",children:p(e.count)}),(0,n.jsx)("div",{children:e.name.replaceAll("_"," ")}),(0,n.jsx)("div",{className:"ml-auto",children:0===e.type?"tag":1===e.type?"artist":3===e.type?"copyright":4===e.type?"character":5===e.type?"metadata":6===e.type?"deprecated":null})]},t))})}):(0,n.jsx)(n.Fragment,{})]}),(0,n.jsx)("button",{className:"btn-neutral",type:"submit",children:"search"})]})})})})},x=()=>{let e=(0,l.useRouter)(),t=t=>{let s=m(e.query.pid);console.log(s),"next"===t?(e.query.pid="".concat(s+1),e.push(e)):"previous"===t&&0!==s&&(e.query.pid="".concat(s-1),e.push(e))};return(0,n.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,n.jsx)("button",{className:"btn-neutral",onClick(){t("previous")},children:"previous"}),(0,n.jsx)("button",{className:"btn-neutral",onClick(){t("next")},children:"next"})]})};var v=s(9603),w=s(9417);let b=()=>{let e=(0,l.useRouter)(),{tags:t,pid:s,rating:c}=e.query,{windowWidth:u}=function(){function e(){let e=window.innerWidth,t=window.innerHeight;return{windowWidth:e,windowHeight:t}}let[t,s]=(0,a.useState)(e());return(0,a.useEffect)(()=>{function t(){s(e())}return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[!0]),t}(),[h,p]=(0,a.useState)(""),[b,j]=(0,a.useState)(""),[y,N]=(0,a.useState)(0),[_,k]=(0,a.useState)([]),[E,C]=(0,a.useState)(),{data:S,isSuccess:q}=r.S.gelbooru.getPosts.useQuery({search:b,pid:y,rating:h},{refetchOnWindowFocus:!1});(0,a.useEffect)(()=>{q&&(S&&S.posts?k(S.posts.map(e=>e)):k([]))},[S,q]),(0,a.useEffect)(()=>{void 0!==c?p(c):e.query.rating="safe",e.push(e)},[c]),(0,a.useEffect)(()=>{void 0!==t?t.length>0?j(t):j(""):e.query.tags="",e.push(e)},[t]),(0,a.useEffect)(()=>{void 0!==s?N(m(s)):e.query.pid="0",e.push(e)},[s]);let L=t=>{let s=t.currentTarget.value;e.query.rating=s,e.push(e)},D=e=>{if("ArrowLeft"===e.key){let t;e.preventDefault(),E&&(_.map((e,s)=>{E.id===e.id&&(t=_[s-1])}),t&&C(t))}else if("ArrowRight"===e.key){let s;e.preventDefault(),E&&(_.map((e,t)=>{E.id===e.id&&(s=_[t+1])}),s&&C(s))}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o(),{children:[(0,n.jsx)("title",{children:"image viewer"}),(0,n.jsx)("meta",{name:"description",content:"Generated by create-t3-app"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsxs)("header",{className:"py-6 px-8",children:[(0,n.jsx)(g,{}),(0,n.jsxs)("div",{className:"flex select-none items-center gap-4 py-4",children:[(0,n.jsxs)("label",{className:"flex items-center gap-1",children:[(0,n.jsx)("input",{type:"radio",name:"contentRating",value:"safe",onChange:L,defaultChecked:"safe"===c}),"safe"]}),(0,n.jsxs)("label",{className:"flex items-center gap-1",children:[(0,n.jsx)("input",{type:"radio",name:"contentRating",value:"nsfw",onChange:L,defaultChecked:"nsfw"===c}),"nsfw"]})]})]}),(0,n.jsxs)("main",{className:"container mx-auto",children:[(0,n.jsx)("div",{className:"py-8",children:q&&(0,n.jsx)("div",{className:"grid-flow-rows grid w-full gap-x-6 gap-y-12 sm:grid-cols-2 sm:px-0 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8",children:_.length>=1?_.map((e,t)=>(0,n.jsx)("div",{className:"relative flex w-full cursor-pointer flex-col",onClick(){C(e)},children:(0,n.jsx)("div",{className:"group flex h-auto max-h-full max-w-full items-center justify-center focus:outline-none sm:h-72 md:h-64 xl:h-48",children:u<640?e.file_url.includes("video")?(0,n.jsx)(d(),{className:"max-h-full max-w-full border-2 border-blue-500 object-contain focus:outline-none group-focus-visible:ring-2 group-focus-visible:ring-black",src:e.sample_url||e.preview_url,alt:"".concat(e.id,": ").concat(e.tags),width:e.sample_width||e.preview_width,height:e.sample_height||e.preview_height,priority:!0,loading:"eager"}):(0,n.jsx)(d(),{className:"max-h-full max-w-full object-contain focus:outline-none group-focus-visible:ring-2 group-focus-visible:ring-black",src:e.file_url,alt:"".concat(e.id,": ").concat(e.tags),width:e.width,height:e.height,priority:!0,loading:"eager"}):(0,n.jsx)(d(),{className:"max-h-full max-w-full object-contain focus:outline-none group-focus-visible:ring-2 group-focus-visible:ring-black",src:e.sample_url||e.preview_url,alt:"".concat(e.id,": ").concat(e.tags),width:e.sample_width||e.preview_width,height:e.sample_height||e.preview_height,priority:!0,loading:"eager"})})},t)):(0,n.jsx)("p",{children:"nothing found :/"})})}),(0,n.jsx)(x,{})]}),E&&(0,n.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center bg-black/60",onLoad(){document.body.style.overflow="hidden",document.addEventListener("keydown",D)},children:[(0,n.jsx)("button",{className:"btn-neutral absolute top-0 right-0 mr-6 mt-6 p-2",onClick(){document.body.style.overflow="auto",document.removeEventListener("keydown",D),C(void 0)},children:(0,n.jsx)(v.G,{className:"h-8 w-8",icon:w.g82})}),(0,n.jsxs)("div",{className:"flex w-full items-center px-12",children:[(0,n.jsx)("button",{className:"btn-neutral p-3",onClick(){let e;_.map((t,s)=>{E.id===t.id&&(e=_[s-1])}),e&&C(e)},children:(0,n.jsx)(v.G,{className:"h-6 w-6",icon:w.acZ})}),(0,n.jsxs)("div",{className:"flex w-full justify-center",children:[(0,n.jsx)(d(),{className:"absolute top-1/2 left-1/2 -z-10 -translate-x-1/2 -translate-y-1/2",src:i,alt:"",quality:10,width:100,height:100}),E.file_url.includes("video")?(0,n.jsxs)("div",{className:"flex min-h-[16rem] flex-col items-center justify-center rounded-xl bg-white p-12",children:[(0,n.jsx)("p",{children:"videos are currently unsupported."}),(0,n.jsx)("p",{children:"please click the source link below to watch."})]}):(0,n.jsx)(d(),{className:"max-h-[85vh] max-w-[80vw] object-contain",src:E.file_url,alt:"".concat(E.id,": ").concat(E.tags),quality:100,width:E.width,height:E.height,priority:!0,loading:"eager"})]}),(0,n.jsx)("button",{className:"btn-neutral p-3",onClick(){let e;_.map((t,s)=>{E.id===t.id&&(e=_[s+1])}),e&&C(e)},children:(0,n.jsx)(v.G,{className:"h-6 w-6",icon:w.eFW})})]}),(0,n.jsxs)("div",{className:"absolute bottom-0 left-1/2 mb-4 flex -translate-x-1/2 gap-4",children:[(0,n.jsx)(f(),{className:"btn-neutral",href:E.file_url,target:"_blank",prefetch:!0,children:"view on Gelbooru"}),(0,n.jsx)(f(),{className:"btn-neutral",href:E.source,target:"_blank",prefetch:!0,children:"source"})]})]})]})};var j=b}},function(e){e.O(0,[976,512,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);